#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path("../../lib", __FILE__)
require "log2blog"
require "github_api"
require "dotenv"

Dotenv.load

if ARGV.any?
  user, repo = ARGV[0].split("/", 2)
  starting_commit = ARGV[1]
else
  user = ENV["GITHUB_USER"]
  repo = ENV["GITHUB_REPO"]
end

filenames_to_exclude = ENV["SKIP_FILES"]

generator = Log2Blog::Generator.new(
  commits_api: Log2Blog::GithubClient.new(
    Github.new(oauth_token: ENV["GITHUB_OAUTH_TOKEN"]).repos.commits
  ),
  renderer: Log2Blog::Renderer.new(exclude: filenames_to_exclude)
)
puts generator.generate_markdown(user: user,
                                 repo: repo,
                                 starting_commit: starting_commit)
